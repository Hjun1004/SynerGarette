<html layout:decorate="~{usr/layout/layout.html}">

<head>
  <title>Title</title>

  <script src="https://js.tosspayments.com/v1/payment-widget"></script>

</head>

<body>

<main layout:fragment="main">

  <script th:inline="javascript">
        const orderId = /*[[ ${order.id} ]]*/ null;
        const buyerName = /*[[ ${order.member.nickname} ]]*/ null;
        const orderName = /*[[ ${order.name} ]]*/ null;
        const orderPayPrice = /*[[ ${order.totalPrice} ]]*/ null;

  </script>

  <div class="container mx-5">

    <!--    <h1 class="mb-4" th:if="${!#lists.isEmpty(cartItemList)}">-->
    <!--      <i class="fa-solid fa-list-ol"></i>-->
    <!--      장바구니 목록-->
    <!--    </h1>-->

    <i class="fa-solid fa-list-ol"></i>
    배송정보
    <br></br>
    <br></br>
    <br></br>

    <i class="fa-solid fa-list-ol"></i>
    상품 정보

      <div th:if="${!#lists.isEmpty(orderItemList)}">
          <div th:each="orderItem : ${orderItemList}" class="mt-5">
            <a class="card bg-base-100 shadow-xl border " th:href="@{|/goods/${orderItem.goods.id}|}">
              <figure></figure>
              <div class="card-body">
                <h2 class="card-title" th:text="${orderItem.goods.goodsName}"></h2>

                <div class="card-actions justify-end">
                  <button class="btn btn-primary">Buy Now</button>
                </div>
              </div>
            </a>
          </div>
      </div>

    <div class="mt-3 text-2xl" th:text="|총 주문금액: ${order.totalPrice} 원|"></div>

    <div class="mt-3 text-2xl" th:text="|주문 이름: ${order.name}|"></div>


    <div>
      <button class="btn btn-neutral mb-3" onclick="payment();">결제하기</button>
    </div>



    <script th:inline="javascript">
    var clientKey = [[${tossPaymentConfig.testClientKey}]]
    var tossPayments = TossPayments(clientKey)

    function payment(){
      tossPayments.requestPayment("카드", {
        amount: orderPayPrice,
        orderId: "order__" + orderId + "__" + (Math.random() + "").substring(2),
        orderName: orderName,
        successUrl: "http://localhost:8080/order/" + orderId + "/success",
        failUrl: 'http://localhost:8080/order/orderId/fail'
      })
    }
  </script>

  </div>

</main>

</body>
</html>